<div style="width: 100%; display: flex">
  <rdaf-spinner></raf-spinner>
  <div id=statusDiv>
    <p>Parameters you can tweak in the URL (and their current settings).</p>
  </div>
</div>
<input type=button onClick="togglePause()" value="toggle pause">
<div style="width: 100%">
  <div id=contentDiv style="overflow: scroll; height: 400px; "></div>
</div>

<script type="module">
  'use strict';

  import * as Locker from '../util/Locker.mjs';

  class SlowSlots extends HTMLElement {
    childToSlot = new Map();
    useISA = true;
    groupSize;
    shadowRoot;

    constructor() {
      super();
      this.shadowRoot = this.attachShadow({mode: 'closed'});
      this.populate();
    }

    populate() {
      this.groupSize = parseInt(this.getAttribute("group-size")) || 10;
      this.useISA = parseInt(this.getAttribute("use-isa"));
      let elementCount = this.children.length;

      let slots = [];
      let slot;
      let i = 0;

      for (const child of this.children) {
        if (i % this.groupSize == 0) {
          slot = document.createElement("slot");
          this.shadowRoot.appendChild(slot);
          slots.push(slot);
          slot.name = slots.length;
        }
        this.childToSlot.set(child, slot);
        i++;
      }

      this.slots = slots;
    }

    assign(slot, elements) {
      if (this.useISA) {
        slot.assign(elements);
      } else {
        for (const e of elements) {
          e.slot = slot.name;
        }
      }
    }

    assignToIndex(i, elements) {
      let slot = this.slots[i];
      slot.assignedNodes();
      this.assign(slot, elements);
    }
  }

  customElements.define('slow-slots', SlowSlots);
</script>
<script type="module">
  import '../util/raf-spinner.mjs';
  import * as Locker from '../util/Locker.mjs';
  import * as Params from '../util/Params.mjs';
  import * as Base from './base.mjs';

  let statusDiv = document.getElementById("statusDiv")
  let ss = document.createElement("slow-slots");
  ss.setAttribute("group-size", Params.get("groupSize", (p) => { return parseInt(p) || 10 }));
  ss.setAttribute("use-isa", Params.get("useISA", (p) => { return parseInt(p)}));
  ss.id = "ss";
  contentDiv.appendChild(ss);
  Base.populate(ss, statusDiv);
  ss.populate();

  let sampleChildren1 = []
  for (let i = 0; i < 10; i++) {
    sampleChildren1.push(ss.children[i]);
  }

  let sampleChildren2 = []
  for (let i = 10; i < 20; i++) {
    sampleChildren2.push(ss.children[i]);
  }

  let pause = false;
  function togglePause() {
    pause = !pause;
  }
  window.togglePause = togglePause;

  function update(i) {
    ss.assignToIndex(1, i % 2 ? sampleChildren1 : sampleChildren2);
  }

  let nFrames = Params.get("nFrames", (p) => {return parseInt(p) || 1}, statusDiv);
  function go() {
    Base.everyNFrames(nFrames, update);
  }
  go();
</script>
