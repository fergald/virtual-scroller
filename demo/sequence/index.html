<!DOCTYPE html>
<style>
  virtual-content:not(:defined) { display: none }
</style>

<script type="module">
  import '../../src/virtual-content.mjs';

  let vc;

  function populate() {
    let words = "";
    for (let i = 0; i < wordCount.value; i++) {
      words += " word";
    }

    vc = document.createElement("virtual-content");
    vc.setUseLocking(useLocking.checked);
    vc.setUseScrollEvents(useScrollEvents.checked);
    contentDiv.innerHTML = "";
    contentDiv.append(vc);
    for (let i = 0; i < elementCount.value; i++) {
      let e = document.createElement("div");
      e.innerText = i + words;
      e.id = "p" + i;
      vc.appendChild(e);
    }
    goButton.disabled = true;
  }
  window.populate = populate;

  function jump() {
    let elements = contentDiv.children[0].children;
    elements[elements.length - 1].scrollIntoView();
  }
  window.jump = jump;

  function onChangeUseScrollEvents() {
    if (vc) {
      vc.setUseScrollEvents(useScrollEvents.checked);
    }
  }
  window.onChangeUseScrollEvents = onChangeUseScrollEvents;

//  populate();
//  customElements.whenDefined('virtual-content').then(async () => {populate()});
</script>
<h1>Demo of display-locking scroller</h1>

<p>If you see red you are seeing "locked" elements and something has
  gone wrong (see below for known issues). You can control whether
  display locking is actually used or not and various other things
  with the form below.
</p>
<p>Things that should work
  <ul>
    <li>scrolling around
    <li>resizing
    <li>adding/removing elements (sorry, not UI for that ATM)
    <li>toggling "Use Scroll Events" is immediate, everything else
    needs to be set before clicking "Go".
  </ul>
</p>
<p>Things that don't work
  <ul>
    <li>scrollIntoView/find-in-page (crashes <a href=https://crbug.com/953614>https://crbug.com/953614</a>)
    <li>Debug inspector crashes if it tries to highlight a locked element
  </ul>
</p>

<div>
  Element Count: <input id=elementCount value=1000><br>
  Word Count: <input id=wordCount value=100><br>
  Use Display Locking: <input id=useLocking type=checkbox><br>
  Use Scroll Events (live): <input id=useScrollEvents type=checkbox onchange="onChangeUseScrollEvents()">
  <br>
  <input type=button onClick="populate()" value="Go" id=goButton>
  <input type=button onClick="jump()" value="Jump" id=jumpButton>
</div>
<div id=contentDiv style="overflow: scroll; height: 400px"></div>
