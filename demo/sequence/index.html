<!DOCTYPE html>
<style>
  virtual-content:not(:defined) { display: none }
</style>

<script type="module">
  import '../../src/index.mjs';
  import * as Words from '../util/Words.mjs';
  import * as Locker from '../util/Locker.mjs'

  let vc;

  function populate() {
    let words = Words.words(wordCount.value);

    vc = document.createElement("virtual-content");
    vc.setUseLocking(useLocking.checked);
    vc.setUseIntersection(useIntersection.checked);
    vc.setUseScrollEvents(useScrollEvents.checked, contentDiv);
    vc.setUseForcedLayouts(useForcedLayouts.checked, contentDiv);
    contentDiv.innerHTML = "";
    contentDiv.append(vc);
    for (const div of Words.divs(elementCount.value, words)) {
      vc.appendChild(div);
    }
    goButton.disabled = true;
  }
  window.populate = populate;

  function jump() {
    let elements = contentDiv.children[0].children;
    elements[elements.length - 1].scrollIntoView();
  }
  window.jump = jump;

  function resize() {
    contentDiv.style.width = contentDiv.style.width == "200px" ? "" : "200px";
  }
  window.resize = resize;

  function logInfo() {
    vc.logInfo();
  }
  window.logInfo = logInfo;

  function onChangeUseScrollEvents() {
    if (vc) {
      vc.setUseScrollEvents(useScrollEvents.checked, contentDiv);
    }
  }
  window.onChangeUseScrollEvents = onChangeUseScrollEvents;

  function onChangeUseForcedLayouts() {
    if (vc) {
      vc.setUseScrollEvents(useForcedLayouts.checked, contentDiv);
    }
  }
  window.onChangeUseForcedLayouts = onChangeUseForcedLayouts;

//  populate();
//  customElements.whenDefined('virtual-content').then(async () => {populate()});
</script>
<h1>Demo of display-locking scroller</h1>

<p>If you see red you are seeing "locked" elements and something has
  gone wrong (see below for known issues). You can control whether
  display locking is actually used or not and various other things
  with the form below.
</p>
<p>Things that should work
  <ul>
    <li>scrolling around
    <li>resizing
    <li>adding/removing elements (sorry, not UI for that ATM)
    <li>toggling "Use Scroll Events" is immediate, everything else
    needs to be set before clicking "Go".
    <li>scrollIntoView/find-in-page
  </ul>
</p>

<div>
  Element Count: <input id=elementCount value=1000><br>
  Word Count: <input id=wordCount value=100><br>
  Use Display Locking: <input id=useLocking type=checkbox checked><br>
  Use Intersection Observer (not binary search): <input id=useIntersection type=checkbox><br>
  Use Scroll Events (live): <input id=useScrollEvents type=checkbox onchange="onChangeUseScrollEvents()"><br>
  Use forced layouts: <input id=useForcedLayouts type=checkbox onchange="onChangeUseForcedLayouts()" checked><br>
  <br>
  <input type=button onClick="populate()" value="Go" id=goButton>
  <input type=button onClick="jump()" value="Jump" id=jumpButton>
  <input type=button onClick="resize()" value="Resize" id=resizeButton>
  <input type=button onClick="logInfo()" value="LogInfo" id=logInfoButton>
</div>
<div id=contentDiv style="overflow: scroll; height: 400px"></div>
